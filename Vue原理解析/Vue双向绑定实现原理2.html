<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="app">
    <input type="text" v-model="text">
    {{text}}
</div>
<script>
    function observe(obj,vm) {
         Object.keys(obj).forEach(function (key) {
             defineReactive(vm,key,obj[key]);
         })
    }
    function defineReactive(obj,key,val){
        var dep = new Dep();
        Object.defineProperty(obj,key,{
            get:function () {
                //添加订阅者watcher到主题对象Dep
                if(Dep.target){
                    dep.addSub(Dep.target)
                }
                return val;
            },
            set:function (newVal) {
                if(newVal === val){
                    return;
                }
                val = newVal;
                dep.notify();
            }
        })
    }
    function Dep() {
        this.subs = [];
    }
    Dep.prototype = {
        addSub:function (sub) {
            this.subs.push(sub)
        },
        notify:function () {
            this.subs.forEach(function (sub) {
                sub.update();
            })
        }
    }
    function Vue(options) {
        this.data = options.data;//
        var data = this.data;
        observe(data,this);
        var id = options.el;
        var dom = nodeToFragment(document.getElementById(id),this);
        //编译完成后，将dom 返回app中
        document.getElementById(id).appendChild(dom);
    }
    var vm = new Vue({
        el:"app",
        data:{
            text:"hello world"
        }
    })


</script>

</body>
</html>